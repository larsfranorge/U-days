<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.typekit.net/yox7lpk.css">
    <link rel="stylesheet" type="text/css" href="CSS/style.css">
    <script src='https://api.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
     <link href='https://api.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
     <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v3.1.6/mapbox-gl-geocoder.min.js'></script>
     <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v3.1.6/mapbox-gl-geocoder.css' type='text/css' />
     <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.9/mapbox-gl-draw.js'></script>
<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-draw/v1.0.9/mapbox-gl-draw.css' type='text/css'/>

    <title>Document</title>
</head>
<body>
    <header class="header2">
        <nav class="nav">
            <a href="index.html">
                <img class="logo" alt="U-days logo" src="Billeder/will-smith.png">
            </a>
            <label class="toggle" for="toggle">&#9776;</label>
            <input type="checkbox" id="toggle" />
            <div class="menu">
                <a href="#">Menu</a>
                <a href="#">Menu</a>
                <a href="#">Menu</a>
                <a href="#">Menu</a>
            </div>
            <div class="menu2">
                <a href="#">Menu</a>
                <a href="#">Menu</a>
                <a href="#">Menu</a>
                <a href="#">Menu</a>
            </div>
        </nav>
    </header>
<main>
        <style>
                .geocoder {
                    height: 100px;
                    width: 150px;
                    position: absolute;
                    top: 20px;
                    left: 10px;
                    background-color: rgba(255, 255, 255, .9);
                    padding: 15px;
                    text-align: left;
                    font-family: 'Arial';
                    margin: 0;
                    font-size: 13px;
                }
                #instructions {
                    position:absolute;
                    height: 50px;
                    margin:20px;
                    width: 25%;
                    top:0;
                    bottom:0;
                    padding: 20px;
                    background-color: rgba(255,255,255,0.9);
                    overflow-y: scroll;
                    font-family: sans-serif;
                }
            
            </style>
    <div id='map' style='width: 1280px; height: 920px;'></div>
        <div class="geocoder">
           <div id="geocoder"></div> 
        </div>
        <div id='instructions'>
            <div id="calculated-line"></div>
        </div>
        
    <script>
        mapboxgl.accessToken = 'pk.eyJ1Ijoibnl5c3RlZCIsImEiOiJjanRqcXdjZm0xMmlyM3lwa25uaHFiZzk3In0.esl6CDTfOUEAwlmAH6KfhQ';
        var instructions = document.getElementById('instructions');
        var map = new mapboxgl.Map({
        container: 'map', // container id
        style: 'mapbox://styles/mapbox/streets-v11', //hosted style id
        center: [56.1629,10.2039], // starting position
        zoom: 13, // starting zoom
        minZoom: 11, // keep it local
        });
        var geocoder = new MapboxGeocoder ( {
            accessToken: mapboxgl.accessToken,
        });

        map.on('load', function() {
            geocoder.on('result', function(ev){
                console.log(ev.result.center);

            } );
        });
        var draw = new MapboxDraw ({
            displayControlsDefault: false,
            controls: {
                line_string: true,
                trash: true
            },
            styles: [
                {
                    "id": "gl-draw-line",
                    "type": "line",
                    "filter": ["all", ["==", "$type", "LineString"], ["!=", "mode", "static"]],
                    "layout": {
                        "line-cap": "round",
                        "line-join": "round"
                    },
                
                "paint": {
                    "line-color": "#3b9dddd",
                    "line-dasharray": [0.2, 2],
                    "line-width": 4,
                    "line-opacity": 0.7
                }},
                {
                "id": "gl-draw-polygon-and-line-vertex-halo-active",
                "type": "circle",
                "filter": ["all", ["==", "meta", "vertex"], ["==", "$type", "Point"], ["!=", "mode", "static"]],
                "paint": {
                    "circle-radius": 6,
                    "circle-color": "#3b9ddd",
                    }
                }
                ]
        });

        map.addControl(draw);

        map.on('draw.create', updateRoute);
        map.on('draw.update', updateRoute);
        map.on('draw.delete', updateRoute);

        function updateRoute() {
            removeRoute();
            var data = draw.getAll();
            var lastFeature = data.features.lenght - 1;
            var coords = data.features(lastFeature).geometry.coordinates;
            var newCoords = coords.join(';');
            getMatch(newCoords)
        }

        function getMatch(e) {
            var url = 'https://api.mapbox.com/directions/v5/mapbox/cycling/' + e 
            + '?geometries=geojson&steps=true&access_token=' + mapboxgl.accessToken;
            var req = new XMLHttpRequest();
            req.responseType = 'json';
            req.open('GET', url, true);
            req.onload = function() {
                var jsonResponse = req.response;
                var distance = jsonResponse.routes[0].distance*0.001;
                var duration = jsonResponse.routes[0].duration/60;
                var steps = jsonResponse.routes[0].legs[0].steps;
                var coords = jsonResponse.routes[0] .geometry;
                console.log(steps.intersections);
                console.log(coords);

                steps.forEach(function(step) {
                    instructions.insertAdjacentHTML('beforeend', '<p>' + step.maneuver.instruction + '</p>');

                });
                instructions.insertAdjacentHTML('beforeend', '<p>' + 'Distance:' + distance.toFixed(2) + 'km<br>Duration: ' + duration.toFixed(2) + 'minutes' + '</p>');
                addRoute(coords);
            };
            req.send();
        }
        function addRoute (coords) {
    
    if (map.getSource('route')) {
        map.removeLayer('route');
        map.removeSource('route')
    } else{
        map.addLayer({
            "id": "route",
            "type": "line",
            "source": {
                "type": "geojson",
                "data": {
                    "type": "Feature",
                    "properties": {},
                    "geometry": coords
                }
            },
            "layout": {
                "line-join": "round",
                "line-cap": "round"
            },
            "paint": {
                "line-color": "#1db7dd",
                "line-width": 8,
                "line-opacity": 0.8
            }
        });
    };
}
function removeRoute () {
        if (map.getSource('route')) {
            map.removeLayer('route');
            map.removeSource('route');
            instructions.innerHTML = '';
        } else  {
            return;
        }
    }
    document.getElementById('geocoder').appendChild(geocoder.onAdd(map));


        map.addControl(new MapboxGeocoder({
        accessToken: mapboxgl.accessToken
        }));
        </script>
        </div>
</main>

    <footer class="footer">
        <div class="footer_indhold">
            <img class="footer_logo" alt="U-days logo" src="Billeder/will-smith.png">
            <div class="footer_kontakt">
                <h4 class="footer_h">Kontakt os</h4>
                <p class="footer_p">Sønderhøj 30</p>
                <p class="footer_p">8260 Viby</p>
                <p class="footer_p">72 28 60 00</p>
                <p class="footer_p">u-days@au.dk</p>
            </div>
            <div class="footer_link">
                <h4 class="footer_h">Links</h4>
                <p class="footer_p">Find Vej</p>
                <p class="footer_p">Studiemiljø</p>
                <p class="footer_p">Dit Program</p>
                <p class="footer_p">Om U-Days</p>
            </div>
            <div class="footer_so-me">
                <h4 class="footer_h">Følg med på</h4>
                <a href="#">
                <i class="fab fa-facebook-square fa-2x awesome">&nbsp<p class="footer_so-me_p">Facebook</p></i>
                </a>
                <a href="#">
                <i class="fab fa-youtube-square fa-2x awesome">&nbsp<p class="footer_so-me_p">Youtube</p></i>
                </a>
                <a class="footer_so-me_a href="#">
                <i class="fab fa-instagram fa-2x awesome">&nbsp<p class="footer_so-me_p"> Instagram</p></i>
                </a>
            </div>
            <div class="footer_dato">
                <p class="footer_p2">28 Februar</p>
                <p class="footer_p2">1. & 2. Marts</p>
                <p class="footer_p2">- 2019 -</p>
            </div>
        </div>
    </footer>
    </body>
    </html>